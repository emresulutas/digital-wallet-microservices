name: Digital Wallet CI ğŸš€

# 1. TETÄ°KLEYÄ°CÄ°: Bu robot ne zaman Ã§alÄ±ÅŸsÄ±n?
on:
  push:
    branches: [ "main", "master" ] # Ana dala kod atÄ±ldÄ±ÄŸÄ±nda
  pull_request:
    branches: [ "main", "master" ] # Biri kod birleÅŸtirmek istediÄŸinde

# 2. GÃ–REVLER: Robot ne yapsÄ±n?
jobs:
  test-pact:
    # GitHub'Ä±n bize vereceÄŸi sanal bilgisayar (Ubuntu Linux)
    runs-on: ubuntu-latest

    steps:
      # A) Bizim kodlarÄ± o sanal bilgisayara indir
      - name: Checkout Code
        uses: actions/checkout@v3

      # B) Docker Compose'u ayaÄŸa kaldÄ±r (TipkÄ± senin PC'de yaptÄ±ÄŸÄ±n gibi)
      - name: Start Containers
        run: docker-compose up -d --build

      # C) BankanÄ±n aÃ§Ä±lmasÄ±nÄ± bekle (VeritabanÄ± kurulsun, seed yapÄ±lsÄ±n)
      - name: Wait for Services (30s)
        run: sleep 30

      # D) API Gateway iÃ§indeki testleri Ã§alÄ±ÅŸtÄ±r
      # 'docker-compose exec' komutu Ã§alÄ±ÅŸan konteynerin iÃ§ine girip komut Ã§alÄ±ÅŸtÄ±rÄ±r.
      - name: Run Pact Contract Tests ğŸ§ª
        run: docker-compose exec -T api-gateway npm run test:pact

      # E) Temizlik: Ä°ÅŸ bitince konteynerleri kapat
      - name: Stop Containers
        if: always() # Test baÅŸarÄ±sÄ±z olsa bile kapat
        run: docker-compose down