name: Digital Wallet CI ğŸš€

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  test-pact:
    runs-on: ubuntu-latest

    # DÃœZELTME BURADA: Åifreleri "steps" iÃ§inden alÄ±p buraya,
    # en tepeye (Global) taÅŸÄ±dÄ±k. ArtÄ±k her adÄ±m bunlarÄ± gÃ¶rebilir.
    env:
      DB_USER: ${{ secrets.DB_USER }}
      DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
      DB_NAME: ${{ secrets.DB_NAME }}
      DB_PORT: ${{ secrets.DB_PORT }}
      API_GATEWAY_PORT: ${{ secrets.API_GATEWAY_PORT }}
      CORE_BANKING_PORT: ${{ secrets.CORE_BANKING_PORT }}

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Start Containers
        # Buradaki 'env' kÄ±smÄ±nÄ± sildik Ã§Ã¼nkÃ¼ yukarÄ±ya taÅŸÄ±dÄ±k
        run: docker compose up -d --build

      - name: Wait for Services (30s)
        run: sleep 30

      - name: Run Pact Contract Tests ğŸ§ª
        # ArtÄ±k bu komut da yukarÄ±daki ÅŸifreleri okuyabilecek
        run: docker compose exec -T api-gateway npm run test:pact

      - name: Stop Containers
        if: always()
        run: docker compose down